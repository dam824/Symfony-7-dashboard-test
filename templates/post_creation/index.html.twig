{# templates/post/create.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Create Post{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('build/main.css') }}">
{% endblock %}

{% block body %}
    <div class="post-content">
        <h1>Create Post</h1>

        {{ form_start(postForm, {'attr': {'enctype': 'multipart/form-data'}}) }}
            <div class="form-group">
                {{ form_label(postForm.slug, 'Slug * (This field use in url path.)') }}
                {{ form_widget(postForm.slug) }}
                {{ form_errors(postForm.slug) }}
            </div>
            <div class="form-group">
                {{ form_label(postForm.title, 'Title *') }}
                {{ form_widget(postForm.title) }}
                {{ form_errors(postForm.title) }}
            </div>
            <div class="form-group">
                {{ form_label(postForm.description, 'Description') }}
                {{ form_widget(postForm.description) }}
                {{ form_errors(postForm.description) }}
            </div>
            <div class="form-group">
                {{ form_label(postForm.images, 'Images') }}
                {{ form_widget(postForm.images, {'attr': {'multiple': 'multiple', 'id': 'imageUpload'}}) }}
                {{ form_errors(postForm.images) }}
                <div id="imagePreview" class="image-preview"></div>
            </div>
            <div class="form-group">
                {{ form_label(postForm.content, 'Content') }}
                {{ form_widget(postForm.content, {'attr': {'id': 'contentField'}}) }}
                {{ form_errors(postForm.content) }}
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Create</button>
                <a href="{{ path('app_dashboard') }}" class="btn btn-secondary">Cancel</a>
            </div>
        {{ form_end(postForm) }}
         <a href="{{ path('app_dashboard') }}" class="dashboard-link">Retour au Dashboard</a>

        {% for message in app.flashes('success') %}
            <div class="flash-success">
                {{ message }}
            </div>
        {% endfor %}

        {% for message in app.flashes('error') %}
            <div class="flash-error">
                {{ message }}
            </div>
        {% endfor %}
    </div>

    <script>
        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const files = event.target.files;
            const previewContainer = document.getElementById('imagePreview');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.classList.add('preview-image');
                    img.draggable = true;
                    img.addEventListener('dragstart', function(ev) {
                        ev.dataTransfer.setData('text/html', img.outerHTML);
                    });
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('contentField').addEventListener('drop', function(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData('text/html');
            this.value += data;
        });

        document.getElementById('contentField').addEventListener('dragover', function(event) {
            event.preventDefault();
        });
    </script>
{% endblock %}
